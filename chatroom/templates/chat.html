<!DOCTYPE html>
<html lang="en">
<head>
    <title>Hacker Chat Room</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
</head>
<body>
    <div class="chat-container">
        <h1 class="chat-title">Room: <span>{{ room }}</span></h1>

        <!-- Message Box -->
        <div id="messages" class="chat-box">
            <!-- Messages will be dynamically added here -->
        </div>

        <!-- Message Input -->
        <form id="messageForm" class="chat-input-container">
            <input type="text" id="messageInput" class="chat-input" placeholder="Type your message..." autocomplete="off" required>
            <button type="submit" class="chat-send-btn">Send</button>
        </form>
    </div>

    <script>
        const socket = io();
        const username = "{{ username }}";
        const room = "{{ room }}";

        // Join the room
        socket.emit('join', { username, room });

        // Display incoming messages
        socket.on('message', (msg) => {
            const messagesDiv = document.getElementById('messages');
            const messageElement = document.createElement('div');
            messageElement.textContent = msg;
            messageElement.classList.add('chat-message');
            messagesDiv.appendChild(messageElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight; // Scroll to the bottom
        });

        // Handle form submission
        document.getElementById('messageForm').onsubmit = (e) => {
            e.preventDefault();
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value;
            socket.emit('message', { username, room, message });
            messageInput.value = '';
        };

        // Handle leaving the room
        window.onbeforeunload = () => {
            socket.emit('leave', { username, room });
        };
    </script>
</body>
</html>
